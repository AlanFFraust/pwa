<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      type="image/png"
      href="https://cdn.icon-icons.com/icons2/618/PNG/512/Currency_Conversion_icon-icons.com_56682.png"
    />
    <link rel="stylesheet" href="./styles.css" />
    <link rel="manifest" href="./manifest.json" />
    <title>Conversor de Monedas</title>
  </head>
  <body>
    <h1>Conversor de Monedas</h1>

    <label for="amount">Cantidad:</label>
    <input type="number" id="amount" placeholder="Ingrese la cantidad" />

    <label for="from">De:</label>
    <select id="from">
      <option value="MXN">Peso Méxicano</option>
      <option value="USD">Dólar</option>
      <option value="EUR">Euro</option>
      <option value="JPY">Yen japonés</option>
      <option value="GBP">Libra esterlina</option>
    </select>

    <label for="to">A:</label>
    <select id="to">
      <option value="USD">Dólar</option>
      <option value="MXN">Peso Méxicano</option>
      <option value="EUR">Euro</option>
      <option value="JPY">Yen japonés</option>
      <option value="GBP">Libra esterlina</option>
    </select>

    <button onclick="realizarConversion()">Convertir</button>

    <div id="result"></div>

    <script>
      function realizarConversion() {
        var amount = parseFloat(document.getElementById("amount").value);
        var fromCurrency = document.getElementById("from").value;
        var toCurrency = document.getElementById("to").value;

        convertirMoneda(amount, fromCurrency, toCurrency);
      }

      navigator.serviceWorker.addEventListener("message", (event) => {
        if (event.data && event.data.type === "conversionResult") {
          const result = event.data.result;

          // Mostrar el resultado
          document.getElementById("result").innerHTML =
            "Resultado: " + result + " " + document.getElementById("to").value;
        }
      });

      // Registrar el Service Worker
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("./sw.js", { scope: "./" })
          .then((registration) => {
            registration.addEventListener("updatefound", () => {
              const newWorker = registration.installing;
              newWorker.addEventListener("statechange", () => {
                if (
                  newWorker.state === "installed" &&
                  navigator.serviceWorker.controller
                ) {
                  window.location.reload();
                }
              });
            });
          })
          .catch((error) => {
            console.error("Error al registrar el Service Worker:", error);
          });
      }

      function convertirMoneda(amount, fromCurrency, toCurrency) {
          sendMessageToServiceWorker({
            type: "convert",
            amount: amount,
            fromCurrency: fromCurrency,
            toCurrency: toCurrency,
          });
      }

      // Función para enviar mensajes al Service Worker
      function sendMessageToServiceWorker(message) {
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage(message);
        } else {
          console.error("Service Worker controller no disponible");
        }
      }
    </script>
  </body>
</html>
